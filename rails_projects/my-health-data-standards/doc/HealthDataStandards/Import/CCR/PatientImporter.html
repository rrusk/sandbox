<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: HealthDataStandards::Import::CCR::PatientImporter
  
    &mdash; Documentation by YARD 0.8.6.1
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../../';
  framesUrl = "../../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../../_index.html">Index (P)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../HealthDataStandards.html" title="HealthDataStandards (module)">HealthDataStandards</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Import.html" title="HealthDataStandards::Import (module)">Import</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../CCR.html" title="HealthDataStandards::Import::CCR (module)">CCR</a></span></span>
     &raquo; 
    <span class="title">PatientImporter</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: HealthDataStandards::Import::CCR::PatientImporter
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">HealthDataStandards::Import::CCR::PatientImporter</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2">Singleton</dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/health-data-standards/import/ccr/patient_importer.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
This class is the central location for taking an ASTM CCR XML document and
converting it into the processed form we store in MongoDB. The class does
this by running each measure independently on the XML document
</p>
<p>
This class is a Singleton. It should be accessed by calling
PatientImporter.instance
</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="Gender-constant" class="">Gender =
          
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>male</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>M</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>female</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>F</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_measure-instance_method" title="#add_measure (instance method)">- (Object) <strong>add_measure</strong>(measure_id, importer) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Adds a measure to run on a CCR that is passed in.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#check_usable-instance_method" title="#check_usable (instance method)">- (Object) <strong>check_usable</strong>(check_usable_entries) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_hash-instance_method" title="#create_hash (instance method)">- (Hash) <strong>create_hash</strong>(doc, check_usable_entries = false) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Create a simple representation of the patient from an ASTM CCR.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_demographics-instance_method" title="#get_demographics (instance method)">- (Object) <strong>get_demographics</strong>(patient, doc, patient_id_xpath) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Inspects a CCR document and populates the patient Hash with first name,
last name birth date and gender.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (PatientImporter) <strong>initialize</strong>(check_usable = true) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Creates a new PatientImporter with the following XPath expressions used to
find content in  an ASTM CCR.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_ccr-instance_method" title="#parse_ccr (instance method)">- (Hash) <strong>parse_ccr</strong>(doc, patient_id_xpath = &quot;//ccr:ContinuityOfCareRecord/ccr:Patient/ccr:ActorID&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Parses a ASTM CCR document and returns a Hash of of the patient.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_events-instance_method" title="#process_events (instance method)">- (Object) <strong>process_events</strong>(patient_record, entries) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Adds the entries and denormalized measure information to the
patient_record.
</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="HealthDataStandards::Import::CCR::PatientImporter (class)">PatientImporter</a></span></tt>) <strong>initialize</strong>(check_usable = true) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Creates a new PatientImporter with the following XPath expressions used to
find content in  an ASTM CCR
</p>
<p>
Encounter entries
</p>
<pre class="code ruby"><code class="ruby">
   //ccr:Encounters/ccr:Encounter
</code></pre>
<p>
Procedure entries
</p>
<pre class="code ruby"><code class="ruby">
   //ccr:Procedures/ccr:Procedure
</code></pre>
<p>
Result entries - 
</p>
<pre class="code ruby"><code class="ruby">
   //ccr:Results/ccr:Result
</code></pre>
<p>
Vital sign entries
</p>
<pre class="code ruby"><code class="ruby">
   //ccr:VitalSigns/ccr:Result
</code></pre>
<p>
Medication entries
</p>
<pre class="code ruby"><code class="ruby">
   //ccr:Medications/ccr:Medication
</code></pre>
<p>
Codes for medications are found in the Product sections
</p>
<pre class="code ruby"><code class="ruby">
   ./ccr:Product
</code></pre>
<p>
Condition entries
</p>
<pre class="code ruby"><code class="ruby">
   //ccr:Problems/ccr:Problem
</code></pre>
<p>
Social History entries 
</p>
<pre class="code ruby"><code class="ruby">
   //ccr:SocialHistory/ccr:SocialHistoryElement
</code></pre>
<p>
Care Goal entries
</p>
<pre class="code ruby"><code class="ruby">
   //ccr:Goals/ccr:Goal
</code></pre>
<p>
Allergy entries
</p>
<pre class="code ruby"><code class="ruby">
   //ccr:Alerts/ccr:Alert
</code></pre>
<p>
Immunization entries
</p>
<pre class="code ruby"><code class="ruby">
   //ccr:Immunizations/ccr:Immunization
</code></pre>
<p>
Codes for immunizations are found in the substanceAdministration with the
following relative XPath
</p>
<pre class="code ruby"><code class="ruby">
   ./ccr:Product</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/health-data-standards/import/ccr/patient_importer.rb', line 55</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span> <span class='lparen'>(</span><span class='id identifier rubyid_check_usable'>check_usable</span> <span class='op'>=</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='ivar'>@measure_importers</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@section_importers</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@section_importers</span><span class='lbracket'>[</span><span class='symbol'>:encounters</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>SimpleImporter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//ccr:Encounters/ccr:Encounter</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='symbol'>:encounters</span><span class='rparen'>)</span>
  <span class='ivar'>@section_importers</span><span class='lbracket'>[</span><span class='symbol'>:procedures</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>SimpleImporter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//ccr:Procedures/ccr:Procedure</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='symbol'>:procedures</span><span class='rparen'>)</span>
  <span class='ivar'>@section_importers</span><span class='lbracket'>[</span><span class='symbol'>:results</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ResultImporter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//ccr:Results/ccr:Result</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='symbol'>:results</span><span class='rparen'>)</span>
  <span class='ivar'>@section_importers</span><span class='lbracket'>[</span><span class='symbol'>:vital_signs</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ResultImporter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//ccr:VitalSigns/ccr:Result</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='symbol'>:vital_signs</span><span class='rparen'>)</span>
  <span class='ivar'>@section_importers</span><span class='lbracket'>[</span><span class='symbol'>:medications</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ProductImporter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//ccr:Medications/ccr:Medication</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:medications</span><span class='rparen'>)</span>
  <span class='ivar'>@section_importers</span><span class='lbracket'>[</span><span class='symbol'>:conditions</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>SimpleImporter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//ccr:Problems/ccr:Problem</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='symbol'>:conditions</span><span class='rparen'>)</span>
  <span class='ivar'>@section_importers</span><span class='lbracket'>[</span><span class='symbol'>:social_history</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>SimpleImporter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//ccr:SocialHistory/ccr:SocialHistoryElement</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:social_history</span><span class='rparen'>)</span>
  <span class='ivar'>@section_importers</span><span class='lbracket'>[</span><span class='symbol'>:care_goals</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>SimpleImporter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//ccr:Goals/ccr:Goal</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='symbol'>:care_goals</span><span class='rparen'>)</span>
  <span class='ivar'>@section_importers</span><span class='lbracket'>[</span><span class='symbol'>:medical_equipment</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ProductImporter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//ccr:Equipment/ccr:EquipmentElement</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='symbol'>:medical_equipment</span><span class='rparen'>)</span>
  <span class='ivar'>@section_importers</span><span class='lbracket'>[</span><span class='symbol'>:allergies</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>SimpleImporter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//ccr:Alerts/ccr:Alert</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='symbol'>:allergies</span><span class='rparen'>)</span>
  <span class='ivar'>@section_importers</span><span class='lbracket'>[</span><span class='symbol'>:immunizations</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ProductImporter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//ccr:Immunizations/ccr:Immunization</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='symbol'>:immunizations</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_measure-instance_method">
  
    - (<tt>Object</tt>) <strong>add_measure</strong>(measure_id, importer) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Adds a measure to run on a CCR that is passed in
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>measure</span>
      
      
        <span class='type'>(<tt>MeasureBase</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
an Class that can extract information from a CCR that is necessary to
calculate the measure
</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


163
164
165</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/health-data-standards/import/ccr/patient_importer.rb', line 163</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_measure'>add_measure</span><span class='lparen'>(</span><span class='id identifier rubyid_measure_id'>measure_id</span><span class='comma'>,</span> <span class='id identifier rubyid_importer'>importer</span><span class='rparen'>)</span>
  <span class='ivar'>@measure_importers</span><span class='lbracket'>[</span><span class='id identifier rubyid_measure_id'>measure_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_importer'>importer</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="check_usable-instance_method">
  
    - (<tt>Object</tt>) <strong>check_usable</strong>(check_usable_entries) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
for check_usable_entries&#8230;importer uses true, stats uses false
</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


73
74
75
76
77</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/health-data-standards/import/ccr/patient_importer.rb', line 73</span>

<span class='kw'>def</span> <span class='id identifier rubyid_check_usable'>check_usable</span><span class='lparen'>(</span><span class='id identifier rubyid_check_usable_entries'>check_usable_entries</span><span class='rparen'>)</span>
  <span class='ivar'>@section_importers</span><span class='period'>.</span><span class='id identifier rubyid_each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_section'>section</span><span class='comma'>,</span> <span class='id identifier rubyid_importer'>importer</span><span class='op'>|</span>
    <span class='id identifier rubyid_importer'>importer</span><span class='period'>.</span><span class='id identifier rubyid_check_for_usable'>check_for_usable</span> <span class='op'>=</span> <span class='id identifier rubyid_check_usable_entries'>check_usable_entries</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_hash-instance_method">
  
    - (<tt>Hash</tt>) <strong>create_hash</strong>(doc, check_usable_entries = false) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Create a simple representation of the patient from an ASTM CCR
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>doc</span>
      
      
        <span class='type'>(<tt>Nokogiri::XML::Document</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
It is expected that the root node of this document will have the
&#8220;ccr&#8221; namespace registered to
&#8220;&#8220;urn:astm-org:CCR&#8221;&#8220;
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
a represnetation of the patient with symbols as keys for each section
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


172
173
174
175
176
177
178
179</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/health-data-standards/import/ccr/patient_importer.rb', line 172</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_hash'>create_hash</span><span class='lparen'>(</span><span class='id identifier rubyid_doc'>doc</span><span class='comma'>,</span> <span class='id identifier rubyid_check_usable_entries'>check_usable_entries</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ccr_patient'>ccr_patient</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@section_importers</span><span class='period'>.</span><span class='id identifier rubyid_each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_section'>section</span><span class='comma'>,</span> <span class='id identifier rubyid_importer'>importer</span><span class='op'>|</span>
    <span class='id identifier rubyid_importer'>importer</span><span class='period'>.</span><span class='id identifier rubyid_check_for_usable'>check_for_usable</span> <span class='op'>=</span> <span class='id identifier rubyid_check_usable_entries'>check_usable_entries</span>
    <span class='id identifier rubyid_ccr_patient'>ccr_patient</span><span class='lbracket'>[</span><span class='id identifier rubyid_section'>section</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_importer'>importer</span><span class='period'>.</span><span class='id identifier rubyid_create_entries'>create_entries</span><span class='lparen'>(</span><span class='id identifier rubyid_doc'>doc</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_ccr_patient'>ccr_patient</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_demographics-instance_method">
  
    - (<tt>Object</tt>) <strong>get_demographics</strong>(patient, doc, patient_id_xpath) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Inspects a CCR document and populates the patient Hash with first name,
last name birth date and gender.
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>patient</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
A hash that is used to represent the patient
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>doc</span>
      
      
        <span class='type'>(<tt>Nokogiri::XML::Node</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The CCR document parsed by Nokogiri
</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/health-data-standards/import/ccr/patient_importer.rb', line 186</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_demographics'>get_demographics</span><span class='lparen'>(</span><span class='id identifier rubyid_patient'>patient</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span><span class='comma'>,</span> <span class='id identifier rubyid_patient_id_xpath'>patient_id_xpath</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_patientActorID'>patientActorID</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//ccr:ContinuityOfCareRecord/ccr:Patient/ccr:ActorID</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
  <span class='id identifier rubyid_patientActor'>patientActor</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//ccr:ContinuityOfCareRecord/ccr:Actors/ccr:Actor[ccr:ActorObjectID = \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_patientActorID'>patientActorID</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot;]</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_patientID'>patientID</span> <span class='op'>=</span> <span class='id identifier rubyid_patientActor'>patientActor</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='id identifier rubyid_patient_id_xpath'>patient_id_xpath</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:content</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_patientID'>patientID</span> <span class='op'>||=</span> <span class='id identifier rubyid_patientActorID'>patientActorID</span>
  
  <span class='id identifier rubyid_name_element'>name_element</span> <span class='op'>=</span> <span class='id identifier rubyid_patientActor'>patientActor</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>./ccr:Person/ccr:Name</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  
  <span class='kw'>if</span> <span class='id identifier rubyid_name_element'>name_element</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_name_element'>name_element</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>./ccr:CurrentName</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_patient'>patient</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>first</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_name_element'>name_element</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>./ccr:CurrentName/ccr:Given</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:content</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_patient'>patient</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>last</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_name_element'>name_element</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>./ccr:CurrentName/ccr:Family</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:content</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_name_element'>name_element</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>./ccr:DisplayName</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='comment'># this will not work in all cases, but we're using it as a last resort if no CurrentName is found
</span>      <span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='id identifier rubyid_last'>last</span> <span class='op'>=</span> <span class='id identifier rubyid_name_element'>name_element</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>./ccr:DisplayName</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_patient'>patient</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>first</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>
      <span class='id identifier rubyid_patient'>patient</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>last</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
      
  
  <span class='id identifier rubyid_birthdate'>birthdate</span> <span class='op'>=</span> <span class='id identifier rubyid_patientActor'>patientActor</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>./ccr:Person//ccr:DateOfBirth/ccr:ExactDateTime | ./ccr:Person//ccr:DateOfBirth/ccr:ApproximateDateTime</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_patient'>patient</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>birthdate</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_birthdate'>birthdate</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='kw'>if</span> <span class='id identifier rubyid_birthdate'>birthdate</span>
  
  <span class='id identifier rubyid_gender_string'>gender_string</span> <span class='op'>=</span> <span class='id identifier rubyid_patientActor'>patientActor</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>./ccr:Person/ccr:Gender/ccr:Text</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span>
  <span class='id identifier rubyid_patient'>patient</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>gender</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span>  <span class='const'>Gender</span><span class='lbracket'>[</span><span class='id identifier rubyid_gender_string'>gender_string</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='rbracket'>]</span>
  <span class='comment'>#race_node = doc.at_xpath('/ccr:placeholder')    #how do you find this?
</span>  <span class='id identifier rubyid_race'>race</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>//ccr:SocialHistory/ccr:SocialHistoryElement[./ccr:Type/ccr:Text = &quot;Race&quot;]/ccr:Description/ccr:Code[./ccr:CodingSystem = &quot;CDC-RE&quot;]/ccr:Value</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ethnicity'>ethnicity</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>//ccr:SocialHistory/ccr:SocialHistoryElement[./ccr:Type/ccr:Text = &quot;Ethnicity&quot;]/ccr:Description/ccr:Code[./ccr:CodingSystem = &quot;CDC-RE&quot;]/ccr:Value</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  
  <span class='kw'>if</span> <span class='id identifier rubyid_ethnicity'>ethnicity</span>
    <span class='id identifier rubyid_patient'>patient</span><span class='lbracket'>[</span><span class='symbol'>:ethnicity</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>code</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ethnicity'>ethnicity</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>codeSystem</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>CDC-RE</span><span class='tstring_end'>'</span></span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
 
  
  <span class='kw'>if</span> <span class='id identifier rubyid_race'>race</span>
     <span class='id identifier rubyid_patient'>patient</span><span class='lbracket'>[</span><span class='symbol'>:race</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>code</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_race'>race</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>codeSystem</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>CDC-RE</span><span class='tstring_end'>'</span></span><span class='rbrace'>}</span>
  <span class='kw'>end</span>

 
 
  <span class='comment'>#ethnicity_node = doc.at_xpath()
</span>  

  <span class='comment'># languages = doc.at_xpath()
</span>  <span class='id identifier rubyid_patient'>patient</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>languages</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
 
  <span class='id identifier rubyid_patient'>patient</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>medical_record_number</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_patientID'>patientID</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse_ccr-instance_method">
  
    - (<tt>Hash</tt>) <strong>parse_ccr</strong>(doc, patient_id_xpath = &quot;//ccr:ContinuityOfCareRecord/ccr:Patient/ccr:ActorID&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Parses a ASTM CCR document and returns a Hash of of the patient.
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>doc</span>
      
      
        <span class='type'>(<tt>Nokogiri::XML::Document</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
It is expected that the root node of this document will have the
&#8220;ccr&#8221; namespace registered to
&#8220;&#8220;urn:astm-org:CCR&#8221;&#8220;
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
a representation of the patient that can be inserted into MongoDB
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


84
85
86
87
88
89
90</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/health-data-standards/import/ccr/patient_importer.rb', line 84</span>

<span class='kw'>def</span> <span class='id identifier rubyid_parse_ccr'>parse_ccr</span><span class='lparen'>(</span><span class='id identifier rubyid_doc'>doc</span><span class='comma'>,</span> <span class='id identifier rubyid_patient_id_xpath'>patient_id_xpath</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//ccr:ContinuityOfCareRecord/ccr:Patient/ccr:ActorID</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ccr_patient'>ccr_patient</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_entries'>entries</span> <span class='op'>=</span> <span class='id identifier rubyid_create_hash'>create_hash</span><span class='lparen'>(</span><span class='id identifier rubyid_doc'>doc</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_get_demographics'>get_demographics</span><span class='lparen'>(</span><span class='id identifier rubyid_ccr_patient'>ccr_patient</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span><span class='comma'>,</span> <span class='id identifier rubyid_patient_id_xpath'>patient_id_xpath</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_process_events'>process_events</span><span class='lparen'>(</span><span class='id identifier rubyid_ccr_patient'>ccr_patient</span><span class='comma'>,</span> <span class='id identifier rubyid_entries'>entries</span><span class='rparen'>)</span>
  <span class='const'>Record</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_ccr_patient'>ccr_patient</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_events-instance_method">
  
    - (<tt>Object</tt>) <strong>process_events</strong>(patient_record, entries) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Adds the entries and denormalized measure information to the
patient_record. Each Entry will be converted to a Hash and stored in an
Array under the appropriate section key, such as medications. Measure
information is listed under the measures key which has a Hash value. The
Hash has the measure id as a key, and the denormalized measure information
as a value
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>patient_record</span>
      
      
        <span class='type'></span>
      
      
      
        &mdash;
        <div class='inline'><ul>
<li><p>
Hash with basic patient demographic information
</p>
</li>
</ul>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/health-data-standards/import/ccr/patient_importer.rb', line 123</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_events'>process_events</span><span class='lparen'>(</span><span class='id identifier rubyid_patient_record'>patient_record</span><span class='comma'>,</span> <span class='id identifier rubyid_entries'>entries</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_patient_record'>patient_record</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>measures</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@measure_importers</span><span class='period'>.</span><span class='id identifier rubyid_each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_measure_id'>measure_id</span><span class='comma'>,</span> <span class='id identifier rubyid_importer'>importer</span><span class='op'>|</span>
    <span class='id identifier rubyid_patient_record'>patient_record</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>measures</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_measure_id'>measure_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_importer'>importer</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_entries'>entries</span><span class='rparen'>)</span>
  <span class='kw'>end</span>


  <span class='id identifier rubyid_entries'>entries</span><span class='period'>.</span><span class='id identifier rubyid_each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='id identifier rubyid_patient_record'>patient_record</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_usable?'>usable?</span>
        <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_to_hash'>to_hash</span>
      <span class='kw'>else</span>
        <span class='kw'>nil</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_patient_record'>patient_record</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue May  7 11:03:40 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.6.1 (ruby-1.9.2).
</div>

  </body>
</html>