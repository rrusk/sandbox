<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: HealthDataStandards::Import::E2E::PatientImporter
  
    &mdash; Documentation by YARD 0.8.6.1
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../../';
  framesUrl = "../../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../../_index.html">Index (P)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../HealthDataStandards.html" title="HealthDataStandards (module)">HealthDataStandards</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Import.html" title="HealthDataStandards::Import (module)">Import</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../E2E.html" title="HealthDataStandards::Import::E2E (module)">E2E</a></span></span>
     &raquo; 
    <span class="title">PatientImporter</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: HealthDataStandards::Import::E2E::PatientImporter
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">HealthDataStandards::Import::E2E::PatientImporter</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="../../Util.html" title="HealthDataStandards::Util (module)">Util</a></span>, Singleton</dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/health-data-standards/import/e2e/patient_importer.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
This class is the central location for taking a PITO E2E XML document and
converting it into the processed form we store in MongoDB. The class does
this by running each measure independently on the XML document
</p>
<p>
This class is a Singleton. It should be accessed by calling
PatientImporter.instance
</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_id_map-instance_method" title="#build_id_map (instance method)">- (Object) <strong>build_id_map</strong>(doc) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#check_for_cause_of_death-instance_method" title="#check_for_cause_of_death (instance method)">- (Object) <strong>check_for_cause_of_death</strong>(e2e_patient) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
THIS METHOD DOESN&#8220;T WORK.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#check_usable-instance_method" title="#check_usable (instance method)">- (Object) <strong>check_usable</strong>(check_usable_entries) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_e2e_hash-instance_method" title="#create_e2e_hash (instance method)">- (Hash) <strong>create_e2e_hash</strong>(record, doc) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Create a simple representation of the patient from a PITO E2E.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_demographics-instance_method" title="#get_demographics (instance method)">- (Object) <strong>get_demographics</strong>(patient, doc) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Inspects a E2E document and populates the patient Hash with first name,
last name birth date, gender and the effectiveTime.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (PatientImporter) <strong>initialize</strong>(check_usable = true) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Creates a new PatientImporter with the following XPath expressions used to
find content in  a PITO E2E:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_e2e-instance_method" title="#parse_e2e (instance method)">- (Record) <strong>parse_e2e</strong>(doc) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Parses a PITO E2E document and returns a Hash of of the patient.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="HealthDataStandards::Import::E2E::PatientImporter (class)">PatientImporter</a></span></tt>) <strong>initialize</strong>(check_usable = true) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Creates a new PatientImporter with the following XPath expressions used to
find content in  a PITO E2E:
</p>
<p>
Encounter entries
</p>
<pre class="code ruby"><code class="ruby">
   //cda:section[cda:templateId/@root='2.16.840.1.113883.3.88.11.83.127']/cda:entry/cda:encounter
</code></pre>
<p>
Procedure entries
</p>
<pre class="code ruby"><code class="ruby">
   //cda:procedure[cda:templateId/@root='2.16.840.1.113883.10.20.1.29']
</code></pre>
<p>
Result entries - There seems to be some confusion around the correct
templateId, so the code checks for both
</p>
<pre class="code ruby"><code class="ruby">
   //cda:observation[cda:templateId/@root='2.16.840.1.113883.3.88.11.83.15.1'] | //cda:observation[cda:templateId/@root='2.16.840.1.113883.3.88.11.83.15']
</code></pre>
<p>
Vital sign entries
</p>
<pre class="code ruby"><code class="ruby">
   //cda:observation[cda:templateId/@root='2.16.840.1.113883.3.88.11.83.14']
</code></pre>
<p>
Medication entries
</p>
<pre class="code ruby"><code class="ruby">
   //cda:section[cda:templateId/@root='2.16.840.1.113883.3.88.11.83.112']/cda:entry/cda:substanceAdministration
</code></pre>
<p>
Codes for medications are found in the substanceAdministration with the
following relative XPath
</p>
<pre class="code ruby"><code class="ruby">
   ./cda:consumable/cda:manufacturedProduct/cda:manufacturedMaterial/cda:code
</code></pre>
<p>
Condition entries
</p>
<pre class="code ruby"><code class="ruby">
   //cda:section[cda:templateId/@root='2.16.840.1.113883.3.88.11.83.103']/cda:entry/cda:act/cda:entryRelationship/cda:observation
</code></pre>
<p>
Codes for conditions are determined by examining the value child element as
opposed to the code child element
</p>
<p>
Social History entries (non-E2E section, specified in the HL7 CCD)
</p>
<pre class="code ruby"><code class="ruby">
   //cda:observation[cda:templateId/@root='2.16.840.1.113883.3.88.11.83.19']
</code></pre>
<p>
Care Goal entries(non-E2E section, specified in the HL7 CCD)
</p>
<pre class="code ruby"><code class="ruby">
   //cda:observation[cda:templateId/@root='2.16.840.1.113883.10.20.1.25']
</code></pre>
<p>
Allergy entries
</p>
<pre class="code ruby"><code class="ruby">
   //cda:observation[cda:templateId/@root='2.16.840.1.113883.10.20.1.18']
</code></pre>
<p>
Immunization entries
</p>
<pre class="code ruby"><code class="ruby">
   //cda:substanceAdministration[cda:templateId/@root='2.16.840.1.113883.10.20.1.24']
</code></pre>
<p>
Codes for immunizations are found in the substanceAdministration with the
following relative XPath
</p>
<pre class="code ruby"><code class="ruby">
   ./cda:consumable/cda:manufacturedProduct/cda:manufacturedMaterial/cda:code</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/health-data-standards/import/e2e/patient_importer.rb', line 55</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_check_usable'>check_usable</span> <span class='op'>=</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='ivar'>@section_importers</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='comment'>#@section_importers[:encounters] = EncounterImporter.new
</span>  <span class='comment'>#@section_importers[:procedures] = ProcedureImporter.new
</span>  <span class='ivar'>@section_importers</span><span class='lbracket'>[</span><span class='symbol'>:results</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ResultImporter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='comment'>#@section_importers[:vital_signs] = VitalSignImporter.new
</span>  <span class='ivar'>@section_importers</span><span class='lbracket'>[</span><span class='symbol'>:medications</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>MedicationImporter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@section_importers</span><span class='lbracket'>[</span><span class='symbol'>:conditions</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ConditionImporter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='comment'>#@section_importers[:social_history] = SectionImporter.new(&quot;//cda:observation[cda:templateId/@root='2.16.840.1.113883.3.88.11.83.19']&quot;)
</span>  <span class='comment'>#@section_importers[:care_goals] = CareGoalImporter.new
</span>  <span class='comment'>#@section_importers[:medical_equipment] = MedicalEquipmentImporter.new
</span>  <span class='comment'>#@section_importers[:allergies] = AllergyImporter.new
</span>  <span class='comment'>#@section_importers[:immunizations] = ImmunizationImporter.new
</span>  <span class='comment'>#@section_importers[:insurance_providers] = InsuranceProviderImporter.new
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="build_id_map-instance_method">
  
    - (<tt>Object</tt>) <strong>build_id_map</strong>(doc) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


71
72
73
74
75
76
77
78
79
80
81
82</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/health-data-standards/import/e2e/patient_importer.rb', line 71</span>

<span class='kw'>def</span> <span class='id identifier rubyid_build_id_map'>build_id_map</span><span class='lparen'>(</span><span class='id identifier rubyid_doc'>doc</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_id_map'>id_map</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//*[@ID]</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_ids'>ids</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ids'>ids</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
    <span class='id identifier rubyid_tag'>tag</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ID</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
    <span class='id identifier rubyid_id_map'>id_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_tag'>tag</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_id_map'>id_map</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="check_for_cause_of_death-instance_method">
  
    - (<tt>Object</tt>) <strong>check_for_cause_of_death</strong>(e2e_patient) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
THIS METHOD DOESN&#8220;T WORK.  THERE IS NO e2e_patient.expired
field/method&#8221; Checks the conditions to see if any of them have a
cause of death set. If they do, it will set the expired field on the
Record. This is done here rather than replacing the expried method on
Record because other formats may actully tell you whether a patient is dead
or not.
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>e2e_patient</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Record.html" title="Record (class)">Record</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
to check the conditions on and set the expired property if applicable
</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


112
113
114
115
116</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/health-data-standards/import/e2e/patient_importer.rb', line 112</span>

<span class='kw'>def</span> <span class='id identifier rubyid_check_for_cause_of_death'>check_for_cause_of_death</span><span class='lparen'>(</span><span class='id identifier rubyid_e2e_patient'>e2e_patient</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_e2e_patient'>e2e_patient</span><span class='period'>.</span><span class='id identifier rubyid_conditions'>conditions</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_condition'>condition</span><span class='op'>|</span> <span class='id identifier rubyid_condition'>condition</span><span class='period'>.</span><span class='id identifier rubyid_cause_of_death'>cause_of_death</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_e2e_patient'>e2e_patient</span><span class='period'>.</span><span class='id identifier rubyid_expired'>expired</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="check_usable-instance_method">
  
    - (<tt>Object</tt>) <strong>check_usable</strong>(check_usable_entries) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>check_usable_entries</span>
      
      
        <span class='type'>(<tt>boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
&#8230;importer uses true, stats uses false
</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


85
86
87
88
89</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/health-data-standards/import/e2e/patient_importer.rb', line 85</span>

<span class='kw'>def</span> <span class='id identifier rubyid_check_usable'>check_usable</span><span class='lparen'>(</span><span class='id identifier rubyid_check_usable_entries'>check_usable_entries</span><span class='rparen'>)</span>
  <span class='ivar'>@section_importers</span><span class='period'>.</span><span class='id identifier rubyid_each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_section'>section</span><span class='comma'>,</span> <span class='id identifier rubyid_importer'>importer</span><span class='op'>|</span>
    <span class='id identifier rubyid_importer'>importer</span><span class='period'>.</span><span class='id identifier rubyid_check_for_usable'>check_for_usable</span> <span class='op'>=</span> <span class='id identifier rubyid_check_usable_entries'>check_usable_entries</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_e2e_hash-instance_method">
  
    - (<tt>Hash</tt>) <strong>create_e2e_hash</strong>(record, doc) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Create a simple representation of the patient from a PITO E2E
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>record</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Record.html" title="Record (class)">Record</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Mongoid model to append the Entry objects to
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>doc</span>
      
      
        <span class='type'>(<tt>Nokogiri::XML::Document</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
It is expected that the root node of this document will have the
&#8220;cda&#8221; namespace registered to &#8220;urn:hl7-org:v3&#8220;
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
a represnetation of the patient with symbols as keys for each section
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


123
124
125
126
127
128</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/health-data-standards/import/e2e/patient_importer.rb', line 123</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_e2e_hash'>create_e2e_hash</span><span class='lparen'>(</span><span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_id_map'>id_map</span> <span class='op'>=</span> <span class='id identifier rubyid_build_id_map'>build_id_map</span><span class='lparen'>(</span><span class='id identifier rubyid_doc'>doc</span><span class='rparen'>)</span>
  <span class='ivar'>@section_importers</span><span class='period'>.</span><span class='id identifier rubyid_each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_section'>section</span><span class='comma'>,</span> <span class='id identifier rubyid_importer'>importer</span><span class='op'>|</span>
    <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_section'>section</span><span class='period'>.</span><span class='id identifier rubyid_to_setter'>to_setter</span><span class='comma'>,</span> <span class='id identifier rubyid_importer'>importer</span><span class='period'>.</span><span class='id identifier rubyid_create_entries'>create_entries</span><span class='lparen'>(</span><span class='id identifier rubyid_doc'>doc</span><span class='comma'>,</span> <span class='id identifier rubyid_id_map'>id_map</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_demographics-instance_method">
  
    - (<tt>Object</tt>) <strong>get_demographics</strong>(patient, doc) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Inspects a E2E document and populates the patient Hash with first name,
last name birth date, gender and the effectiveTime.
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>patient</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
A hash that is used to represent the patient
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>doc</span>
      
      
        <span class='type'>(<tt>Nokogiri::XML::Node</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The E2E document parsed by Nokogiri
</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/health-data-standards/import/e2e/patient_importer.rb', line 135</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_demographics'>get_demographics</span><span class='lparen'>(</span><span class='id identifier rubyid_patient'>patient</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_effective_date'>effective_date</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/cda:ClinicalDocument/cda:effectiveTime</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>value</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  
  <span class='id identifier rubyid_patient'>patient</span><span class='period'>.</span><span class='id identifier rubyid_effective_time'>effective_time</span> <span class='op'>=</span> <span class='const'>HL7Helper</span><span class='period'>.</span><span class='id identifier rubyid_timestamp_to_integer'>timestamp_to_integer</span><span class='lparen'>(</span><span class='id identifier rubyid_effective_date'>effective_date</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_patient_element'>patient_element</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/cda:ClinicalDocument/cda:recordTarget/cda:patientRole/cda:patient</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_patient'>patient</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>=</span> <span class='id identifier rubyid_patient_element'>patient_element</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>cda:name/cda:given</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span>
  <span class='id identifier rubyid_patient'>patient</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span> <span class='op'>=</span> <span class='id identifier rubyid_patient_element'>patient_element</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>cda:name/cda:family</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span>
  <span class='id identifier rubyid_birthdate_in_hl7ts_node'>birthdate_in_hl7ts_node</span> <span class='op'>=</span> <span class='id identifier rubyid_patient_element'>patient_element</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>cda:birthTime</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_birthdate_in_hl7ts'>birthdate_in_hl7ts</span> <span class='op'>=</span> <span class='id identifier rubyid_birthdate_in_hl7ts_node'>birthdate_in_hl7ts_node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>value</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_patient'>patient</span><span class='period'>.</span><span class='id identifier rubyid_birthdate'>birthdate</span> <span class='op'>=</span> <span class='const'>HL7Helper</span><span class='period'>.</span><span class='id identifier rubyid_timestamp_to_integer'>timestamp_to_integer</span><span class='lparen'>(</span><span class='id identifier rubyid_birthdate_in_hl7ts'>birthdate_in_hl7ts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_gender_node'>gender_node</span> <span class='op'>=</span> <span class='id identifier rubyid_patient_element'>patient_element</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>cda:administrativeGenderCode</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_patient'>patient</span><span class='period'>.</span><span class='id identifier rubyid_gender'>gender</span> <span class='op'>=</span> <span class='id identifier rubyid_gender_node'>gender_node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>code</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_id_node'>id_node</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/cda:ClinicalDocument/cda:recordTarget/cda:patientRole/cda:id</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_patient'>patient</span><span class='period'>.</span><span class='id identifier rubyid_medical_record_number'>medical_record_number</span> <span class='op'>=</span> <span class='id identifier rubyid_id_node'>id_node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>extension</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  
  <span class='comment'># parse race, ethnicity, and spoken language
</span>  <span class='comment'>#race_node = patient_element.at_xpath('cda:raceCode')
</span>  <span class='comment'>#patient.race = { code: race_node['code'], code_set: 'CDC-RE' } if race_node
</span>  <span class='comment'>#ethnicity_node = patient_element.at_xpath('cda:ethnicGroupCode')
</span>  <span class='comment'>#patient.ethnicity = {code: ethnicity_node['code'], code_set: 'CDC-RE'} if ethnicity_node
</span>
  <span class='id identifier rubyid_languages'>languages</span> <span class='op'>=</span> <span class='id identifier rubyid_patient_element'>patient_element</span><span class='period'>.</span><span class='id identifier rubyid_search'>search</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>languageCommunication</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_lc'>lc</span><span class='op'>|</span> <span class='id identifier rubyid_lc'>lc</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>cda:languageCode</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>code</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_patient'>patient</span><span class='period'>.</span><span class='id identifier rubyid_languages'>languages</span> <span class='op'>=</span> <span class='id identifier rubyid_languages'>languages</span> <span class='kw'>unless</span> <span class='id identifier rubyid_languages'>languages</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse_e2e-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Record.html" title="Record (class)">Record</a></span></tt>) <strong>parse_e2e</strong>(doc) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Parses a PITO E2E document and returns a Hash of of the patient.
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>doc</span>
      
      
        <span class='type'>(<tt>Nokogiri::XML::Document</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
It is expected that the root node of this document will have the
&#8220;cda&#8221; namespace registered to &#8220;urn:hl7-org:v3&#8220;
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Record.html" title="Record (class)">Record</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
a Mongoid model representing the patient
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98
99
100
101
102
103</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/health-data-standards/import/e2e/patient_importer.rb', line 96</span>

<span class='kw'>def</span> <span class='id identifier rubyid_parse_e2e'>parse_e2e</span><span class='lparen'>(</span><span class='id identifier rubyid_doc'>doc</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_e2e_patient'>e2e_patient</span> <span class='op'>=</span> <span class='const'>Record</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_get_demographics'>get_demographics</span><span class='lparen'>(</span><span class='id identifier rubyid_e2e_patient'>e2e_patient</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_create_e2e_hash'>create_e2e_hash</span><span class='lparen'>(</span><span class='id identifier rubyid_e2e_patient'>e2e_patient</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span><span class='rparen'>)</span>
  <span class='comment'>#check_for_cause_of_death(e2e_patient)
</span>  
  <span class='id identifier rubyid_e2e_patient'>e2e_patient</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue May  7 11:03:40 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.6.1 (ruby-1.9.2).
</div>

  </body>
</html>