<record>
  <patientInformation>
    <id><%= record.id%></id>
    <name>
      <title><%= record.title %></title>
      <givenName><%= record.first %></givenName>
      <familyName><%= record.last %></familyName>
    </name>
    <gender code="<%= record.gender %>" codeSystem="2.16.840.1.113883.5.1" />
    <dateOfBirth><%= time_if_not_nil(record.birthdate) %></dateOfBirth>
    <dateOfDeath><%= time_if_not_nil(record.deathdate) %></dateOfDeath>
    <maritalStatus />
    <religiousAffiliation />
    <% if record.race %>
      <race code="<%=record.race['code']%>" codeSystem="2.16.840.1.113883.6.238" />
    <% end %>
    <% if record.ethnicity %>
      <ethnicity code="<%=record.ethnicity['code']%>" codeSystem="2.16.840.1.113883.6.238" />
    <% end %>
    <languagesSpoken>
    <% record.languages.each do |l| %>
      <language><%=l%></language>
    <% end%>
    </languagesSpoken>
  </patientInformation>
  <allergies>
    <% record.allergies.each do |a| %>
      <%== render partial: "allergy", locals: {allergy: a} %>
    <% end %>
  </allergies>
  <conditions>
    <% record.conditions.each do |c| %>
      <%== render partial: "condition", locals: {condition: c} %>
    <% end %>
  </conditions>
  <immunizations>
    <% record.immunizations.each do |i| %>
      <%== render partial: "immunization", locals: {immunization: i} %>
    <% end %>
  </immunizations>
  <insuranceProviders>
    <% record.insurance_providers.each do |ip| %>
      <%== render partial: "insurance_providers", locals: {insurance_provider: ip} %>
    <% end %>
  </insuranceProviders>
  <medicalEquipment>
    <% record.medical_equipment.each do |me| %>
      <%== render partial: "medical_equipment", locals: {medical_equipment: me} %>
    <% end %>
  </medicalEquipment>
  <medications>
    <% record.medications.each do |m| %>
      <%== render partial: "medication", locals: {medication: m} %>
    <% end %>
  </medications>
  <procedures>
    <% record.procedures.each do |pr| %>
      <%== render partial: "procedure", locals: {procedure: pr} %>
    <% end %>
  </procedures>
  <results>
    <% record.results.each do |r| %>
      <%== render partial: "result", locals: {result: r} %>
    <% end %>
  </results>
  <socialHistory>
    <% record.social_history.each do |sh| %>
      <%== render partial: "social_history", locals: {social_history: sh} %>
    <% end %>
  </socialHistory>
  <support>
    <% record.support.each do |s| %>
     <%== render partial: "support", locals: {support: s}%>
    <% end %>
  </support>
  <vitalSigns>
    <% record.vital_signs.each do |vs| %>
      <%== render partial: "vital_sign", locals: {vital_sign: vs} %>
    <% end %>
  </vitalSigns>
</record>